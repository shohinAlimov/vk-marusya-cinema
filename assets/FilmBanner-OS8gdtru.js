import{r as n,j as e}from"./vendor-dGG96ymH.js";import{c as C,u as N,d as E,R as k,M}from"./index-C9GYjjd4.js";const V=t=>n.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("path",{d:"M10 5H13.3333V35H10V5ZM26.6667 5H30V35H26.6667V5Z",fill:"black"})),T=t=>n.createElement("svg",{width:40,height:40,viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("path",{d:"M10 33.6595V6.34035C10 5.0313 11.4399 4.23322 12.55 4.92702L34.4053 18.5867C35.4498 19.2393 35.4498 20.7605 34.4053 21.4133L12.55 35.0728C11.4399 35.7667 10 34.9687 10 33.6595Z",fill:"black"})),F=t=>{const s=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,d=t.match(s);return d?d[1]:null},I=({isOpen:t,onClose:s,youtubeUrl:d,title:_})=>{const[i,b]=n.useState(!0),[p,u]=n.useState(!1),a=n.useRef(null),l=n.useRef(null),h=F(d),f=()=>{u(!0),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{u(!1)},3e3)},w=()=>{i&&f()},x=()=>{i&&f()};n.useEffect(()=>{if(!t)return;const o=r=>{r.code==="Space"||r.key===" "?(r.preventDefault(),m()):(r.code==="Escape"||r.key==="Escape")&&(r.preventDefault(),s())};return document.body.style.overflow="hidden",document.addEventListener("keydown",o),()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",o)}},[t,i]),n.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),n.useEffect(()=>{if(!t||!h)return;const o=()=>{if(window.YT){r();return}const c=document.createElement("script");c.src="https://www.youtube.com/iframe_api",c.async=!0,document.head.appendChild(c),window.onYouTubeIframeAPIReady=r},r=()=>{a.current=new window.YT.Player("youtube-player",{width:"960",height:"540",videoId:h,playerVars:{autoplay:1,controls:0,showinfo:0,modestbranding:1,rel:0,fs:0,cc_load_policy:0,iv_load_policy:3,disablekb:0,playsinline:1},events:{onReady:c=>{c.target.playVideo()}}})};return o(),()=>{a.current&&a.current.destroy()}},[t,h]);const m=()=>{a.current&&(i?(a.current.pauseVideo(),b(!1),u(!1),l.current&&clearTimeout(l.current)):(a.current.playVideo(),b(!0),f()))};return t?e.jsx("div",{className:"trailer-modal",children:e.jsx("div",{className:"trailer-modal__overlay",onClick:s,children:e.jsxs("div",{className:"trailer-modal__content",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:"trailer-modal__close",onClick:s,children:e.jsx(C,{className:"trailer-modal__close-icon",width:24,height:24,"aria-hidden":!0})}),e.jsx("div",{className:"trailer-modal__video",onClick:m,onMouseEnter:w,onMouseMove:x,style:{pointerEvents:"auto",position:"relative",zIndex:999},children:e.jsx("div",{id:"youtube-player",style:{pointerEvents:"none"}})}),!i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"trailer-modal__title trailer-modal__title--show",children:_}),e.jsx("button",{className:"trailer-modal__control-btn trailer-modal__control-btn--show",onClick:m,children:e.jsx(T,{className:"trailer-modal__play-icon",width:40,height:40,"aria-hidden":!0})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`trailer-modal__title ${p?"trailer-modal__title--show":""}`,children:_}),e.jsx("button",{className:`trailer-modal__control-btn ${p?"trailer-modal__control-btn--show":""}`,onClick:m,children:e.jsx(V,{className:"trailer-modal__play-icon",width:40,height:40,"aria-hidden":!0})})]})]})})}):null},S=t=>n.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("path",{d:"M16.5 3C19.5376 3 22 5.5 22 9C22 16 14.5 20 12 21.5C9.5 20 2 16 2 9C2 5.5 4.5 3 7.5 3C9.35997 3 11 4 12 5C13 4 14.64 3 16.5 3Z",fill:"currentColor",stroke:"#B4A9FF",strokeWidth:1})),H=t=>n.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("path",{d:"M12 4C14.7486 4 17.1749 5.38626 18.6156 7.5H16V9.5H22V3.5H20V5.99936C18.1762 3.57166 15.2724 2 12 2C6.47715 2 2 6.47715 2 12H4C4 7.58172 7.58172 4 12 4ZM20 12C20 16.4183 16.4183 20 12 20C9.25144 20 6.82508 18.6137 5.38443 16.5H8V14.5H2V20.5H4V18.0006C5.82381 20.4283 8.72764 22 12 22C17.5228 22 22 17.5228 22 12H20Z",fill:"currentColor"})),L=({movie:t,onDetailsClick:s,onRefreshRequest:d,showRefresh:_=!1,showDetails:i=!0,className:b="",row:p=!1})=>{const[u,a]=n.useState(null),[l,h]=n.useState(!1),{user:f}=N(),[w,x]=n.useState(!1),{isFavorite:m,toggleFavorite:o}=E(),[r,c]=n.useState(!1),v=m(t.id),y=()=>{c(!0)},j=async()=>{if(!f){a("Необходимо войти в систему для добавления в избранное"),x(!0);return}try{await o(t.id)}catch(g){a(g instanceof Error?g.message:"Ошибка при работе с избранным")}finally{h(!1)}};return e.jsx("div",{className:`film-banner ${b}`,children:e.jsxs("div",{className:"film-banner__wrapper",children:[e.jsxs("div",{className:"film-banner__inner",children:[e.jsxs("div",{className:"film-banner__info",children:[e.jsxs("div",{className:"film-banner__overlay",children:[e.jsx(k,{movie:t}),e.jsx("span",{className:"film-banner__notes",children:t.releaseYear}),e.jsx("span",{className:"film-banner__notes",children:t.genres.join(", ")}),e.jsxs("span",{className:"film-banner__notes",children:[t.runtime," мин"]})]}),e.jsx("h2",{className:"film-banner__title",children:t.title}),e.jsx("p",{className:"film-banner__plot",children:t.plot})]}),e.jsxs("div",{className:`film-banner__actions ${p&&"film-banner__actions--row"}`,children:[e.jsx("button",{className:"btn btn--primary film-banner__btn-trailer",onClick:y,"aria-label":"Открыть трейлер",children:"Трейлер"}),e.jsx(I,{isOpen:r,onClose:()=>c(!1),youtubeUrl:t.trailerUrl,title:t.title}),i&&s&&e.jsx("button",{className:"btn btn--secondary film-banner__btn-about",onClick:s,"aria-label":"Подробнее о фильме",children:"О фильме"}),e.jsx("button",{className:`film-banner__btn ${v?"film-banner__btn--active":""}`,onClick:j,disabled:l,"aria-label":v?"Удалить из избранного":"Добавить в избранное",children:e.jsx(S,{className:"film-banner__favorite-icon",width:24,height:24})}),u&&w&&e.jsxs(M,{showLogo:!1,isOpen:w,onClose:()=>x(!1),children:[e.jsx("h2",{className:"film-banner__error-title",children:"Войдите в систему"}),e.jsx("p",{className:"film-banner__error-value",children:u})]}),_&&d&&e.jsx("button",{className:"btn btn--secondary btn--secondary-S film-banner__btn-random",onClick:d,"aria-label":"Обновить",children:e.jsx(H,{width:24,height:24})})]})]}),e.jsx("img",{className:"film-banner__poster",src:t.posterUrl,alt:`Постер фильма "${t.title}"`})]})})};export{L as F};
