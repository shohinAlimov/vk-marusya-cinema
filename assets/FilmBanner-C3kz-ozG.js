import{r as s,j as e}from"./vendor-dGG96ymH.js";import{I as C,u as N,c as k,R as M,M as E}from"./index-Cx2DR24a.js";const V="data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%205H13.3333V35H10V5ZM26.6667%205H30V35H26.6667V5Z'%20fill='black'/%3e%3c/svg%3e",I="data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%2033.6595V6.34035C10%205.0313%2011.4399%204.23322%2012.55%204.92702L34.4053%2018.5867C35.4498%2019.2393%2035.4498%2020.7605%2034.4053%2021.4133L12.55%2035.0728C11.4399%2035.7667%2010%2034.9687%2010%2033.6595Z'%20fill='black'/%3e%3c/svg%3e",T=t=>{const l=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,d=t.match(l);return d?d[1]:null},F=({isOpen:t,onClose:l,youtubeUrl:d,title:_})=>{const[i,b]=s.useState(!0),[p,u]=s.useState(!1),n=s.useRef(null),r=s.useRef(null),h=T(d),f=()=>{u(!0),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{u(!1)},3e3)},w=()=>{i&&f()},x=()=>{i&&f()};s.useEffect(()=>{if(!t)return;const o=a=>{a.code==="Space"||a.key===" "?(a.preventDefault(),m()):(a.code==="Escape"||a.key==="Escape")&&(a.preventDefault(),l())};return document.body.style.overflow="hidden",document.addEventListener("keydown",o),()=>{document.body.style.overflow="unset",document.removeEventListener("keydown",o)}},[t,i]),s.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]),s.useEffect(()=>{if(!t||!h)return;const o=()=>{if(window.YT){a();return}const c=document.createElement("script");c.src="https://www.youtube.com/iframe_api",c.async=!0,document.head.appendChild(c),window.onYouTubeIframeAPIReady=a},a=()=>{n.current=new window.YT.Player("youtube-player",{width:"960",height:"540",videoId:h,playerVars:{autoplay:1,controls:0,showinfo:0,modestbranding:1,rel:0,fs:0,cc_load_policy:0,iv_load_policy:3,disablekb:0,playsinline:1},events:{onReady:c=>{c.target.playVideo()}}})};return o(),()=>{n.current&&n.current.destroy()}},[t,h]);const m=()=>{n.current&&(i?(n.current.pauseVideo(),b(!1),u(!1),r.current&&clearTimeout(r.current)):(n.current.playVideo(),b(!0),f()))};return t?e.jsx("div",{className:"trailer-modal",children:e.jsx("div",{className:"trailer-modal__overlay",onClick:l,children:e.jsxs("div",{className:"trailer-modal__content",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:"trailer-modal__close",onClick:l,children:e.jsx(C,{className:"trailer-modal__close-icon",width:24,height:24,"aria-hidden":!0})}),e.jsx("div",{className:"trailer-modal__video",onClick:m,onMouseEnter:w,onMouseMove:x,style:{pointerEvents:"auto",position:"relative",zIndex:999},children:e.jsx("div",{id:"youtube-player",style:{pointerEvents:"none"}})}),!i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"trailer-modal__title trailer-modal__title--show",children:_}),e.jsx("button",{className:"trailer-modal__control-btn trailer-modal__control-btn--show",onClick:m,children:e.jsx(I,{className:"trailer-modal__play-icon",width:40,height:40,"aria-hidden":!0})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`trailer-modal__title ${p?"trailer-modal__title--show":""}`,children:_}),e.jsx("button",{className:`trailer-modal__control-btn ${p?"trailer-modal__control-btn--show":""}`,onClick:m,children:e.jsx(V,{className:"trailer-modal__play-icon",width:40,height:40,"aria-hidden":!0})})]})]})})}):null},H="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16.5%203C19.5376%203%2022%205.5%2022%209C22%2016%2014.5%2020%2012%2021.5C9.5%2020%202%2016%202%209C2%205.5%204.5%203%207.5%203C9.35997%203%2011%204%2012%205C13%204%2014.64%203%2016.5%203Z'%20fill='currentColor'%20stroke='%23B4A9FF'%20stroke-width='1'%20/%3e%3c/svg%3e",P="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%204C14.7486%204%2017.1749%205.38626%2018.6156%207.5H16V9.5H22V3.5H20V5.99936C18.1762%203.57166%2015.2724%202%2012%202C6.47715%202%202%206.47715%202%2012H4C4%207.58172%207.58172%204%2012%204ZM20%2012C20%2016.4183%2016.4183%2020%2012%2020C9.25144%2020%206.82508%2018.6137%205.38443%2016.5H8V14.5H2V20.5H4V18.0006C5.82381%2020.4283%208.72764%2022%2012%2022C17.5228%2022%2022%2017.5228%2022%2012H20Z'%20fill='currentColor'/%3e%3c/svg%3e",L=({movie:t,onDetailsClick:l,onRefreshRequest:d,showRefresh:_=!1,showDetails:i=!0,className:b="",row:p=!1})=>{const[u,n]=s.useState(null),[r,h]=s.useState(!1),{user:f}=N(),[w,x]=s.useState(!1),{isFavorite:m,toggleFavorite:o}=k(),[a,c]=s.useState(!1),g=m(t.id),y=()=>{c(!0)},j=async()=>{if(!f){n("Необходимо войти в систему для добавления в избранное"),x(!0);return}try{await o(t.id)}catch(v){n(v instanceof Error?v.message:"Ошибка при работе с избранным")}finally{h(!1)}};return e.jsx("div",{className:`film-banner ${b}`,children:e.jsxs("div",{className:"film-banner__wrapper",children:[e.jsxs("div",{className:"film-banner__inner",children:[e.jsxs("div",{className:"film-banner__info",children:[e.jsxs("div",{className:"film-banner__overlay",children:[e.jsx(M,{movie:t}),e.jsx("span",{className:"film-banner__notes",children:t.releaseYear}),e.jsx("span",{className:"film-banner__notes",children:t.genres.join(", ")}),e.jsxs("span",{className:"film-banner__notes",children:[t.runtime," мин"]})]}),e.jsx("h2",{className:"film-banner__title",children:t.title}),e.jsx("p",{className:"film-banner__plot",children:t.plot})]}),e.jsxs("div",{className:`film-banner__actions ${p&&"film-banner__actions--row"}`,children:[e.jsx("button",{className:"btn btn--primary film-banner__btn-trailer",onClick:y,"aria-label":"Открыть трейлер",children:"Трейлер"}),e.jsx(F,{isOpen:a,onClose:()=>c(!1),youtubeUrl:t.trailerUrl,title:t.title}),i&&l&&e.jsx("button",{className:"btn btn--secondary film-banner__btn-about",onClick:l,"aria-label":"Подробнее о фильме",children:"О фильме"}),e.jsx("button",{className:`film-banner__btn ${g?"film-banner__btn--active":""}`,onClick:j,disabled:r,"aria-label":g?"Удалить из избранного":"Добавить в избранное",children:e.jsx(H,{className:"film-banner__favorite-icon",width:24,height:24})}),u&&w&&e.jsxs(E,{showLogo:!1,isOpen:w,onClose:()=>x(!1),children:[e.jsx("h2",{className:"film-banner__error-title",children:"Войдите в систему"}),e.jsx("p",{className:"film-banner__error-value",children:u})]}),_&&d&&e.jsx("button",{className:"btn btn--secondary btn--secondary-S film-banner__btn-random",onClick:d,"aria-label":"Обновить",children:e.jsx(P,{width:24,height:24})})]})]}),e.jsx("img",{className:"film-banner__poster",src:t.posterUrl,alt:`Постер фильма "${t.title}"`})]})})};export{L as F};
